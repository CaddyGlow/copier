name: CI

on:
  push:
    branches: [ "main" ]
    tags: [ "v*" ]
  pull_request:
  workflow_dispatch:
    inputs:
      targets:
        description: 'JSON array of targets to build (leave empty for all default targets)'
        required: false
        type: string
        default: ''
      force_release:
        description: 'Force a release even without a tag'
        required: false
        type: boolean
        default: false

permissions:
  contents: write

jobs:
  ci:
    uses: CaddyGlow/homebrew-packages/.github/workflows/rust-ci.yml@main
    with:
      binaries: '["quickctx", "quickctx-analyze"]'
      assets: '["README.md"]'
      test_command: 'cargo test --all-features'
      clippy_args: '--all-targets --all-features'
      targets: ${{ inputs.targets || '' }}
      force_release: ${{ inputs.force_release || false }}
